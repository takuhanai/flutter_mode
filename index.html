<html>
    <head>
        <title>wgld.org WebGL sample</title>
        <script src="script.js" type="text/javascript"></script>
        <script src="minMatrixb.js" type="text/javascript"></script>
        
        <script id="vs" type="x-shader/x-vertex">
			attribute vec3 position;
			attribute vec3 disp1;
			attribute vec3 disp2;
			attribute vec3 frc1;
			attribute vec3 frc2;
			//attribute vec3 normal;
			//attribute vec2 textureCoord;
			//attribute vec4 color;
			uniform vec4 color;
			uniform   mat4 mvpMatrix;
			uniform float r1;
			uniform float r2;
			uniform float disp_amp;
			uniform float force_range;
			//uniform   mat4 invMatrix;
			//uniform   vec3 lightDirection;
			//uniform   vec3 eyeDirection;
			//uniform   vec4 ambientColor;
			varying   vec4 vColor;
			//varying   vec2 vTextureCoord;
			
			void main(void){
				//vec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;
				//vec3  invEye   = normalize(invMatrix * vec4(eyeDirection, 0.0)).xyz;
				//vec3  halfLE   = normalize(invLight + invEye);
				//float diffuse  = clamp(dot(normal, invLight), 0.0, 1.0);
				//float specular = pow(clamp(dot(normal, halfLE), 0.0, 1.0), 50.0);
				//vec4  light    = color * vec4(vec3(diffuse), 1.0) + vec4(vec3(specular), 1.0) * 0.3;
				//vec4  light    = color * vec4(vec3(diffuse), 1.0) * 0.8;
				//vColor         = light + ambientColor;
				//vColor	       = color;
				//float f_range = 1.0;
				float frc = frc1.x * r1 + frc2.x * r2;
				float n_frc = - frc / force_range;
				if (n_frc < -0.5) {
					vColor = vec4(0.0, 2.0 * (n_frc + 1.0), 1.0, 1.0);
				} else if (n_frc < 0.0) {
					vColor = vec4(0.0, 1.0, -2.0 * n_frc, 1.0);
				} else if (n_frc < 0.5) {
					vColor = vec4(2.0 * n_frc, 1.0, 0.0, 1.0);
				} else {
					vColor = vec4(1.0, -2.0 * (n_frc -1.0), 0.0, 1.0);
				}
				//vColor = color * (frc1.x * r1 + frc2.x * r2) *0.001;
				//vTextureCoord  = textureCoord;
				vec3 dispShape = position + disp1 * r1 * disp_amp + disp2 * r2 * disp_amp;
				gl_Position    = mvpMatrix * vec4(dispShape, 1.0);
				//gl_Position    = mvpMatrix * vec4(disp1, 1.0);
			}
        </script>
        
        <script id="fs" type="x-shader/x-fragment">
			precision mediump float;
			
			//uniform sampler2D texture;
			varying vec4      vColor;
			//varying vec2      vTextureCoord;
			
			void main(void){
				//vec4 smpColor = texture2D(texture, vTextureCoord);
				gl_FragColor = vColor;
				//gl_FragColor  = vColor * smpColor;
				//gl_FragColor  = smpColor;
			}
        </script>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        	<p>
			<input id="rot" type="range" min="0" max="360" value="0"> Rotation
		</p>
		<p>
			<input id="disp_amp" type="range" min="0" max="3000" value="1000"> Deformation Amplitude
		</p>
		<p>
			<input id="force_range" type="range" min="0.1" max="20" value="1"> Force Range
		</p>
		<p>
			<input id="speed" type="range" min="0" max="10" value="2"> Speed
		</p>
    </body>
</html>